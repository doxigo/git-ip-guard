#!/bin/bash

# git-ip-info: Display current IP information and git configuration
# Can be installed to /usr/local/bin/ for system-wide use

# Colors for output
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
MAGENTA='\033[0;35m'
BOLD='\033[1m'
NC='\033[0m' # No Color

# Function to get IP info with fallback
get_ip_info() {
    local ip_info=""
    
    # Try primary service (ifconfig.co)
    ip_info=$(curl -s --connect-timeout 5 --max-time 10 https://ifconfig.co/json 2>/dev/null)
    
    # Check if we got a forbidden error, rate limit error or empty response
    if [ -z "$ip_info" ] || echo "$ip_info" | grep -q "Forbidden" || echo "$ip_info" | grep -q "Rate limit exceeded" || echo "$ip_info" | grep -q "429"; then
        # Try fallback service (ipinfo.io)
        ip_info=$(curl -s --connect-timeout 5 --max-time 10 https://ipinfo.io/json 2>/dev/null)
        
        # If fallback also fails, try one more time with ipinfo.io after a brief pause
        if [ -z "$ip_info" ] || echo "$ip_info" | grep -q "Forbidden"; then
            sleep 2
            ip_info=$(curl -s --connect-timeout 5 --max-time 10 https://ipinfo.io/json 2>/dev/null)
        fi
    fi
    
    echo "$ip_info"
}

# Function to get country flag
get_flag() {
    case "$1" in
        "AD") echo "ğŸ‡¦ğŸ‡©" ;;
        "AE") echo "ğŸ‡¦ğŸ‡ª" ;;
        "AF") echo "ğŸ‡¦ğŸ‡«" ;;
        "AG") echo "ğŸ‡¦ğŸ‡¬" ;;
        "AI") echo "ğŸ‡¦ğŸ‡®" ;;
        "AL") echo "ğŸ‡¦ğŸ‡±" ;;
        "AM") echo "ğŸ‡¦ğŸ‡²" ;;
        "AO") echo "ğŸ‡¦ğŸ‡´" ;;
        "AQ") echo "ğŸ‡¦ğŸ‡¶" ;;
        "AR") echo "ğŸ‡¦ğŸ‡·" ;;
        "AS") echo "ğŸ‡¦ğŸ‡¸" ;;
        "AT") echo "ğŸ‡¦ğŸ‡¹" ;;
        "AU") echo "ğŸ‡¦ğŸ‡º" ;;
        "AW") echo "ğŸ‡¦ğŸ‡¼" ;;
        "AX") echo "ğŸ‡¦ğŸ‡½" ;;
        "AZ") echo "ğŸ‡¦ğŸ‡¿" ;;
        "BA") echo "ğŸ‡§ğŸ‡¦" ;;
        "BB") echo "ğŸ‡§ğŸ‡§" ;;
        "BD") echo "ğŸ‡§ğŸ‡©" ;;
        "BE") echo "ğŸ‡§ğŸ‡ª" ;;
        "BF") echo "ğŸ‡§ğŸ‡«" ;;
        "BG") echo "ğŸ‡§ğŸ‡¬" ;;
        "BH") echo "ğŸ‡§ğŸ‡­" ;;
        "BI") echo "ğŸ‡§ğŸ‡®" ;;
        "BJ") echo "ğŸ‡§ğŸ‡¯" ;;
        "BL") echo "ğŸ‡§ğŸ‡±" ;;
        "BM") echo "ğŸ‡§ğŸ‡²" ;;
        "BN") echo "ğŸ‡§ğŸ‡³" ;;
        "BO") echo "ğŸ‡§ğŸ‡´" ;;
        "BQ") echo "ğŸ‡§ğŸ‡¶" ;;
        "BR") echo "ğŸ‡§ğŸ‡·" ;;
        "BS") echo "ğŸ‡§ğŸ‡¸" ;;
        "BT") echo "ğŸ‡§ğŸ‡¹" ;;
        "BV") echo "ğŸ‡§ğŸ‡»" ;;
        "BW") echo "ğŸ‡§ğŸ‡¼" ;;
        "BY") echo "ğŸ‡§ğŸ‡¾" ;;
        "BZ") echo "ğŸ‡§ğŸ‡¿" ;;
        "CA") echo "ğŸ‡¨ğŸ‡¦" ;;
        "CC") echo "ğŸ‡¨ğŸ‡¨" ;;
        "CD") echo "ğŸ‡¨ğŸ‡©" ;;
        "CF") echo "ğŸ‡¨ğŸ‡«" ;;
        "CG") echo "ğŸ‡¨ğŸ‡¬" ;;
        "CH") echo "ğŸ‡¨ğŸ‡­" ;;
        "CI") echo "ğŸ‡¨ğŸ‡®" ;;
        "CK") echo "ğŸ‡¨ğŸ‡°" ;;
        "CL") echo "ğŸ‡¨ğŸ‡±" ;;
        "CM") echo "ğŸ‡¨ğŸ‡²" ;;
        "CN") echo "ğŸ‡¨ğŸ‡³" ;;
        "CO") echo "ğŸ‡¨ğŸ‡´" ;;
        "CR") echo "ğŸ‡¨ğŸ‡·" ;;
        "CU") echo "ğŸ‡¨ğŸ‡º" ;;
        "CV") echo "ğŸ‡¨ğŸ‡»" ;;
        "CW") echo "ğŸ‡¨ğŸ‡¼" ;;
        "CX") echo "ğŸ‡¨ğŸ‡½" ;;
        "CY") echo "ğŸ‡¨ğŸ‡¾" ;;
        "CZ") echo "ğŸ‡¨ğŸ‡¿" ;;
        "DE") echo "ğŸ‡©ğŸ‡ª" ;;
        "DJ") echo "ğŸ‡©ğŸ‡¯" ;;
        "DK") echo "ğŸ‡©ğŸ‡°" ;;
        "DM") echo "ğŸ‡©ğŸ‡²" ;;
        "DO") echo "ğŸ‡©ğŸ‡´" ;;
        "DZ") echo "ğŸ‡©ğŸ‡¿" ;;
        "EC") echo "ğŸ‡ªğŸ‡¨" ;;
        "EE") echo "ğŸ‡ªğŸ‡ª" ;;
        "EG") echo "ğŸ‡ªğŸ‡¬" ;;
        "EH") echo "ğŸ‡ªğŸ‡­" ;;
        "ER") echo "ğŸ‡ªğŸ‡·" ;;
        "ES") echo "ğŸ‡ªğŸ‡¸" ;;
        "ET") echo "ğŸ‡ªğŸ‡¹" ;;
        "FI") echo "ğŸ‡«ğŸ‡®" ;;
        "FJ") echo "ğŸ‡«ğŸ‡¯" ;;
        "FK") echo "ğŸ‡«ğŸ‡°" ;;
        "FM") echo "ğŸ‡«ğŸ‡²" ;;
        "FO") echo "ğŸ‡«ğŸ‡´" ;;
        "FR") echo "ğŸ‡«ğŸ‡·" ;;
        "GA") echo "ğŸ‡¬ğŸ‡¦" ;;
        "GB") echo "ğŸ‡¬ğŸ‡§" ;;
        "GD") echo "ğŸ‡¬ğŸ‡©" ;;
        "GE") echo "ğŸ‡¬ğŸ‡ª" ;;
        "GF") echo "ğŸ‡¬ğŸ‡«" ;;
        "GG") echo "ğŸ‡¬ğŸ‡¬" ;;
        "GH") echo "ğŸ‡¬ğŸ‡­" ;;
        "GI") echo "ğŸ‡¬ğŸ‡®" ;;
        "GL") echo "ğŸ‡¬ğŸ‡±" ;;
        "GM") echo "ğŸ‡¬ğŸ‡²" ;;
        "GN") echo "ğŸ‡¬ğŸ‡³" ;;
        "GP") echo "ğŸ‡¬ğŸ‡µ" ;;
        "GQ") echo "ğŸ‡¬ğŸ‡¶" ;;
        "GR") echo "ğŸ‡¬ğŸ‡·" ;;
        "GS") echo "ğŸ‡¬ğŸ‡¸" ;;
        "GT") echo "ğŸ‡¬ğŸ‡¹" ;;
        "GU") echo "ğŸ‡¬ğŸ‡º" ;;
        "GW") echo "ğŸ‡¬ğŸ‡¼" ;;
        "GY") echo "ğŸ‡¬ğŸ‡¾" ;;
        "HK") echo "ğŸ‡­ğŸ‡°" ;;
        "HM") echo "ğŸ‡­ğŸ‡²" ;;
        "HN") echo "ğŸ‡­ğŸ‡³" ;;
        "HR") echo "ğŸ‡­ğŸ‡·" ;;
        "HT") echo "ğŸ‡­ğŸ‡¹" ;;
        "HU") echo "ğŸ‡­ğŸ‡º" ;;
        "ID") echo "ğŸ‡®ğŸ‡©" ;;
        "IE") echo "ğŸ‡®ğŸ‡ª" ;;
        "IL") echo "ğŸ‡®ğŸ‡±" ;;
        "IM") echo "ğŸ‡®ğŸ‡²" ;;
        "IN") echo "ğŸ‡®ğŸ‡³" ;;
        "IO") echo "ğŸ‡®ğŸ‡´" ;;
        "IQ") echo "ğŸ‡®ğŸ‡¶" ;;
        "IR") echo "ğŸ‡®ğŸ‡·" ;;
        "IS") echo "ğŸ‡®ğŸ‡¸" ;;
        "IT") echo "ğŸ‡®ğŸ‡¹" ;;
        "JE") echo "ğŸ‡¯ğŸ‡ª" ;;
        "JM") echo "ğŸ‡¯ğŸ‡²" ;;
        "JO") echo "ğŸ‡¯ğŸ‡´" ;;
        "JP") echo "ğŸ‡¯ğŸ‡µ" ;;
        "KE") echo "ğŸ‡°ğŸ‡ª" ;;
        "KG") echo "ğŸ‡°ğŸ‡¬" ;;
        "KH") echo "ğŸ‡°ğŸ‡­" ;;
        "KI") echo "ğŸ‡°ğŸ‡®" ;;
        "KM") echo "ğŸ‡°ğŸ‡²" ;;
        "KN") echo "ğŸ‡°ğŸ‡³" ;;
        "KP") echo "ğŸ‡°ğŸ‡µ" ;;
        "KR") echo "ğŸ‡°ğŸ‡·" ;;
        "KW") echo "ğŸ‡°ğŸ‡¼" ;;
        "KY") echo "ğŸ‡°ğŸ‡¾" ;;
        "KZ") echo "ğŸ‡°ğŸ‡¿" ;;
        "LA") echo "ğŸ‡±ğŸ‡¦" ;;
        "LB") echo "ğŸ‡±ğŸ‡§" ;;
        "LC") echo "ğŸ‡±ğŸ‡¨" ;;
        "LI") echo "ğŸ‡±ğŸ‡®" ;;
        "LK") echo "ğŸ‡±ğŸ‡°" ;;
        "LR") echo "ğŸ‡±ğŸ‡·" ;;
        "LS") echo "ğŸ‡±ğŸ‡¸" ;;
        "LT") echo "ğŸ‡±ğŸ‡¹" ;;
        "LU") echo "ğŸ‡±ğŸ‡º" ;;
        "LV") echo "ğŸ‡±ğŸ‡»" ;;
        "LY") echo "ğŸ‡±ğŸ‡¾" ;;
        "MA") echo "ğŸ‡²ğŸ‡¦" ;;
        "MC") echo "ğŸ‡²ğŸ‡¨" ;;
        "MD") echo "ğŸ‡²ğŸ‡©" ;;
        "ME") echo "ğŸ‡²ğŸ‡ª" ;;
        "MF") echo "ğŸ‡²ğŸ‡«" ;;
        "MG") echo "ğŸ‡²ğŸ‡¬" ;;
        "MH") echo "ğŸ‡²ğŸ‡­" ;;
        "MK") echo "ğŸ‡²ğŸ‡°" ;;
        "ML") echo "ğŸ‡²ğŸ‡±" ;;
        "MM") echo "ğŸ‡²ğŸ‡²" ;;
        "MN") echo "ğŸ‡²ğŸ‡³" ;;
        "MO") echo "ğŸ‡²ğŸ‡´" ;;
        "MP") echo "ğŸ‡²ğŸ‡µ" ;;
        "MQ") echo "ğŸ‡²ğŸ‡¶" ;;
        "MR") echo "ğŸ‡²ğŸ‡·" ;;
        "MS") echo "ğŸ‡²ğŸ‡¸" ;;
        "MT") echo "ğŸ‡²ğŸ‡¹" ;;
        "MU") echo "ğŸ‡²ğŸ‡º" ;;
        "MV") echo "ğŸ‡²ğŸ‡»" ;;
        "MW") echo "ğŸ‡²ğŸ‡¼" ;;
        "MX") echo "ğŸ‡²ğŸ‡½" ;;
        "MY") echo "ğŸ‡²ğŸ‡¾" ;;
        "MZ") echo "ğŸ‡²ğŸ‡¿" ;;
        "NA") echo "ğŸ‡³ğŸ‡¦" ;;
        "NC") echo "ğŸ‡³ğŸ‡¨" ;;
        "NE") echo "ğŸ‡³ğŸ‡ª" ;;
        "NF") echo "ğŸ‡³ğŸ‡«" ;;
        "NG") echo "ğŸ‡³ğŸ‡¬" ;;
        "NI") echo "ğŸ‡³ğŸ‡®" ;;
        "NL") echo "ğŸ‡³ğŸ‡±" ;;
        "NO") echo "ğŸ‡³ğŸ‡´" ;;
        "NP") echo "ğŸ‡³ğŸ‡µ" ;;
        "NR") echo "ğŸ‡³ğŸ‡·" ;;
        "NU") echo "ğŸ‡³ğŸ‡º" ;;
        "NZ") echo "ğŸ‡³ğŸ‡¿" ;;
        "OM") echo "ğŸ‡´ğŸ‡²" ;;
        "PA") echo "ğŸ‡µğŸ‡¦" ;;
        "PE") echo "ğŸ‡µğŸ‡ª" ;;
        "PF") echo "ğŸ‡µğŸ‡«" ;;
        "PG") echo "ğŸ‡µğŸ‡¬" ;;
        "PH") echo "ğŸ‡µğŸ‡­" ;;
        "PK") echo "ğŸ‡µğŸ‡°" ;;
        "PL") echo "ğŸ‡µğŸ‡±" ;;
        "PM") echo "ğŸ‡µğŸ‡²" ;;
        "PN") echo "ğŸ‡µğŸ‡³" ;;
        "PR") echo "ğŸ‡µğŸ‡·" ;;
        "PS") echo "ğŸ‡µğŸ‡¸" ;;
        "PT") echo "ğŸ‡µğŸ‡¹" ;;
        "PW") echo "ğŸ‡µğŸ‡¼" ;;
        "PY") echo "ğŸ‡µğŸ‡¾" ;;
        "QA") echo "ğŸ‡¶ğŸ‡¦" ;;
        "RE") echo "ğŸ‡·ğŸ‡ª" ;;
        "RO") echo "ğŸ‡·ğŸ‡´" ;;
        "RS") echo "ğŸ‡·ğŸ‡¸" ;;
        "RU") echo "ğŸ‡·ğŸ‡º" ;;
        "RW") echo "ğŸ‡·ğŸ‡¼" ;;
        "SA") echo "ğŸ‡¸ğŸ‡¦" ;;
        "SB") echo "ğŸ‡¸ğŸ‡§" ;;
        "SC") echo "ğŸ‡¸ğŸ‡¨" ;;
        "SD") echo "ğŸ‡¸ğŸ‡©" ;;
        "SE") echo "ğŸ‡¸ğŸ‡ª" ;;
        "SG") echo "ğŸ‡¸ğŸ‡¬" ;;
        "SH") echo "ğŸ‡¸ğŸ‡­" ;;
        "SI") echo "ğŸ‡¸ğŸ‡®" ;;
        "SJ") echo "ğŸ‡¸ğŸ‡¯" ;;
        "SK") echo "ğŸ‡¸ğŸ‡°" ;;
        "SL") echo "ğŸ‡¸ğŸ‡±" ;;
        "SM") echo "ğŸ‡¸ğŸ‡²" ;;
        "SN") echo "ğŸ‡¸ğŸ‡³" ;;
        "SO") echo "ğŸ‡¸ğŸ‡´" ;;
        "SR") echo "ğŸ‡¸ğŸ‡·" ;;
        "SS") echo "ğŸ‡¸ğŸ‡¸" ;;
        "ST") echo "ğŸ‡¸ğŸ‡¹" ;;
        "SV") echo "ğŸ‡¸ğŸ‡»" ;;
        "SX") echo "ğŸ‡¸ğŸ‡½" ;;
        "SY") echo "ğŸ‡¸ğŸ‡¾" ;;
        "SZ") echo "ğŸ‡¸ğŸ‡¿" ;;
        "TC") echo "ğŸ‡¹ğŸ‡¨" ;;
        "TD") echo "ğŸ‡¹ğŸ‡©" ;;
        "TF") echo "ğŸ‡¹ğŸ‡«" ;;
        "TG") echo "ğŸ‡¹ğŸ‡¬" ;;
        "TH") echo "ğŸ‡¹ğŸ‡­" ;;
        "TJ") echo "ğŸ‡¹ğŸ‡¯" ;;
        "TK") echo "ğŸ‡¹ğŸ‡°" ;;
        "TL") echo "ğŸ‡¹ğŸ‡±" ;;
        "TM") echo "ğŸ‡¹ğŸ‡²" ;;
        "TN") echo "ğŸ‡¹ğŸ‡³" ;;
        "TO") echo "ğŸ‡¹ğŸ‡´" ;;
        "TR") echo "ğŸ‡¹ğŸ‡·" ;;
        "TT") echo "ğŸ‡¹ğŸ‡¹" ;;
        "TV") echo "ğŸ‡¹ğŸ‡»" ;;
        "TW") echo "ğŸ‡¹ğŸ‡¼" ;;
        "TZ") echo "ğŸ‡¹ğŸ‡¿" ;;
        "UA") echo "ğŸ‡ºğŸ‡¦" ;;
        "UG") echo "ğŸ‡ºğŸ‡¬" ;;
        "UM") echo "ğŸ‡ºğŸ‡²" ;;
        "US") echo "ğŸ‡ºğŸ‡¸" ;;
        "UY") echo "ğŸ‡ºğŸ‡¾" ;;
        "UZ") echo "ğŸ‡ºğŸ‡¿" ;;
        "VA") echo "ğŸ‡»ğŸ‡¦" ;;
        "VC") echo "ğŸ‡»ğŸ‡¨" ;;
        "VE") echo "ğŸ‡»ğŸ‡ª" ;;
        "VG") echo "ğŸ‡»ğŸ‡¬" ;;
        "VI") echo "ğŸ‡»ğŸ‡®" ;;
        "VN") echo "ğŸ‡»ğŸ‡³" ;;
        "VU") echo "ğŸ‡»ğŸ‡º" ;;
        "WF") echo "ğŸ‡¼ğŸ‡«" ;;
        "WS") echo "ğŸ‡¼ğŸ‡¸" ;;
        "XK") echo "ğŸ‡½ğŸ‡°" ;;
        "YE") echo "ğŸ‡¾ğŸ‡ª" ;;
        "YT") echo "ğŸ‡¾ğŸ‡¹" ;;
        "ZA") echo "ğŸ‡¿ğŸ‡¦" ;;
        "ZM") echo "ğŸ‡¿ğŸ‡²" ;;
        "ZW") echo "ğŸ‡¿ğŸ‡¼" ;;
        *) echo "ğŸ³ï¸" ;;
    esac
}

# Clear screen for clean display
clear

# Header
echo -e "${CYAN}${BOLD}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                    Git & IP Information                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"

# Get git configuration
echo -e "${BLUE}${BOLD}Git Configuration:${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# Get git user name
GIT_USER_NAME=$(git config --get user.name 2>/dev/null)
if [ -z "$GIT_USER_NAME" ]; then
    GIT_USER_NAME="${RED}Not configured${NC}"
else
    GIT_USER_NAME="${GREEN}$GIT_USER_NAME${NC}"
fi

# Get git user email
GIT_USER_EMAIL=$(git config --get user.email 2>/dev/null)
if [ -z "$GIT_USER_EMAIL" ]; then
    GIT_USER_EMAIL="${RED}Not configured${NC}"
else
    GIT_USER_EMAIL="${GREEN}$GIT_USER_EMAIL${NC}"
fi

# Get git global vs local config info
if git rev-parse --git-dir > /dev/null 2>&1; then
    # We're in a git repository
    LOCAL_NAME=$(git config --local --get user.name 2>/dev/null)
    LOCAL_EMAIL=$(git config --local --get user.email 2>/dev/null)
    GLOBAL_NAME=$(git config --global --get user.name 2>/dev/null)
    GLOBAL_EMAIL=$(git config --global --get user.email 2>/dev/null)
    
    echo -e "  ${BOLD}User Name:${NC}  $GIT_USER_NAME"
    if [ -n "$LOCAL_NAME" ] && [ "$LOCAL_NAME" != "$GLOBAL_NAME" ]; then
        echo -e "              ${YELLOW}(Local override in this repository)${NC}"
    fi
    
    echo -e "  ${BOLD}User Email:${NC} $GIT_USER_EMAIL"
    if [ -n "$LOCAL_EMAIL" ] && [ "$LOCAL_EMAIL" != "$GLOBAL_EMAIL" ]; then
        echo -e "              ${YELLOW}(Local override in this repository)${NC}"
    fi
else
    # Not in a git repository, show global config only
    echo -e "  ${BOLD}User Name:${NC}  $GIT_USER_NAME ${YELLOW}(global)${NC}"
    echo -e "  ${BOLD}User Email:${NC} $GIT_USER_EMAIL ${YELLOW}(global)${NC}"
fi

echo ""

# Get IP information
echo -e "${BLUE}${BOLD}IP & Location Information:${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "${YELLOW}Fetching IP information...${NC}"

# Get IP info
IP_INFO=$(get_ip_info)

if [ -z "$IP_INFO" ]; then
    echo -e "${RED}Error: Could not fetch IP information${NC}"
    exit 1
fi

# Extract details
IP=$(echo "$IP_INFO" | jq -r '.ip // empty' 2>/dev/null)
COUNTRY_ISO=$(echo "$IP_INFO" | jq -r '.country_iso // .country // empty' 2>/dev/null | tr '[:lower:]' '[:upper:]')
COUNTRY_NAME=$(echo "$IP_INFO" | jq -r '.country // empty' 2>/dev/null)
CITY=$(echo "$IP_INFO" | jq -r '.city // empty' 2>/dev/null)
REGION=$(echo "$IP_INFO" | jq -r '.region // empty' 2>/dev/null)
ORG=$(echo "$IP_INFO" | jq -r '.org // .asn_org // empty' 2>/dev/null)
TIMEZONE=$(echo "$IP_INFO" | jq -r '.timezone // .time_zone // empty' 2>/dev/null)

# Get country flag
FLAG=$(get_flag "$COUNTRY_ISO")

# Determine full country name
if [ -n "$COUNTRY_NAME" ] && [ "$COUNTRY_NAME" != "$COUNTRY_ISO" ] && [ "$COUNTRY_NAME" != "null" ]; then
    # We have a full country name from ifconfig.co
    COUNTRY_DISPLAY="$COUNTRY_NAME"
else
    # We only have ISO code, let's map it to full name
    case "$COUNTRY_ISO" in
        "NO") COUNTRY_DISPLAY="Norway" ;;
        "US") COUNTRY_DISPLAY="United States" ;;
        "GB") COUNTRY_DISPLAY="United Kingdom" ;;
        "DE") COUNTRY_DISPLAY="Germany" ;;
        "FR") COUNTRY_DISPLAY="France" ;;
        "CA") COUNTRY_DISPLAY="Canada" ;;
        "AU") COUNTRY_DISPLAY="Australia" ;;
        "JP") COUNTRY_DISPLAY="Japan" ;;
        "CN") COUNTRY_DISPLAY="China" ;;
        "IN") COUNTRY_DISPLAY="India" ;;
        "BR") COUNTRY_DISPLAY="Brazil" ;;
        "MX") COUNTRY_DISPLAY="Mexico" ;;
        "IT") COUNTRY_DISPLAY="Italy" ;;
        "ES") COUNTRY_DISPLAY="Spain" ;;
        "NL") COUNTRY_DISPLAY="Netherlands" ;;
        "SE") COUNTRY_DISPLAY="Sweden" ;;
        "CH") COUNTRY_DISPLAY="Switzerland" ;;
        "PL") COUNTRY_DISPLAY="Poland" ;;
        "TR") COUNTRY_DISPLAY="Turkey" ;;
        "KR") COUNTRY_DISPLAY="South Korea" ;;
        "IR") COUNTRY_DISPLAY="Iran" ;;
        "RU") COUNTRY_DISPLAY="Russia" ;;
        "BY") COUNTRY_DISPLAY="Belarus" ;;
        "CU") COUNTRY_DISPLAY="Cuba" ;;
        "SY") COUNTRY_DISPLAY="Syria" ;;
        "KP") COUNTRY_DISPLAY="North Korea" ;;
        "UA") COUNTRY_DISPLAY="Ukraine" ;;
        "DK") COUNTRY_DISPLAY="Denmark" ;;
        "FI") COUNTRY_DISPLAY="Finland" ;;
        "IS") COUNTRY_DISPLAY="Iceland" ;;
        "IE") COUNTRY_DISPLAY="Ireland" ;;
        "BE") COUNTRY_DISPLAY="Belgium" ;;
        "AT") COUNTRY_DISPLAY="Austria" ;;
        "PT") COUNTRY_DISPLAY="Portugal" ;;
        "CZ") COUNTRY_DISPLAY="Czech Republic" ;;
        "GR") COUNTRY_DISPLAY="Greece" ;;
        "HU") COUNTRY_DISPLAY="Hungary" ;;
        "RO") COUNTRY_DISPLAY="Romania" ;;
        "BG") COUNTRY_DISPLAY="Bulgaria" ;;
        "HR") COUNTRY_DISPLAY="Croatia" ;;
        "SK") COUNTRY_DISPLAY="Slovakia" ;;
        "SI") COUNTRY_DISPLAY="Slovenia" ;;
        "LT") COUNTRY_DISPLAY="Lithuania" ;;
        "LV") COUNTRY_DISPLAY="Latvia" ;;
        "EE") COUNTRY_DISPLAY="Estonia" ;;
        "LU") COUNTRY_DISPLAY="Luxembourg" ;;
        "MT") COUNTRY_DISPLAY="Malta" ;;
        "CY") COUNTRY_DISPLAY="Cyprus" ;;
        *) COUNTRY_DISPLAY="$COUNTRY_ISO" ;;
    esac
fi

# Clear the "Fetching..." line and display results
echo -e "\033[1A\033[K"  # Move up one line and clear it

echo -e "  ${BOLD}IP Address:${NC}  ${GREEN}$IP${NC}"

# Build location string, handling empty values
LOCATION="$FLAG ${GREEN}"
if [ -n "$CITY" ] && [ "$CITY" != "null" ]; then
    LOCATION="${LOCATION}$CITY"
fi
if [ -n "$REGION" ] && [ "$REGION" != "null" ] && [ "$REGION" != "$CITY" ]; then
    if [ -n "$CITY" ] && [ "$CITY" != "null" ]; then
        LOCATION="${LOCATION}, $REGION"
    else
        LOCATION="${LOCATION}$REGION"
    fi
fi
if [ -n "$COUNTRY_DISPLAY" ]; then
    if [ -n "$CITY" ] && [ "$CITY" != "null" ] || [ -n "$REGION" ] && [ "$REGION" != "null" ]; then
        LOCATION="${LOCATION}, $COUNTRY_DISPLAY"
    else
        LOCATION="${LOCATION}$COUNTRY_DISPLAY"
    fi
fi
LOCATION="${LOCATION}${NC}"

echo -e "  ${BOLD}Location:${NC}    $LOCATION"
if [ -n "$ORG" ] && [ "$ORG" != "null" ]; then
    echo -e "  ${BOLD}ISP/Org:${NC}     ${GREEN}$ORG${NC}"
fi
if [ -n "$TIMEZONE" ] && [ "$TIMEZONE" != "null" ]; then
    echo -e "  ${BOLD}Timezone:${NC}    ${GREEN}$TIMEZONE${NC}"
fi

# Check if current location is in sanctioned list
echo ""
echo -e "${BLUE}${BOLD}Git IP Guard Status:${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# Check for git-ip-guard configuration
CONFIG_FILE="$HOME/.git-templates/hooks/ip-check-config.json"
if [ -f "$CONFIG_FILE" ]; then
    BLOCKED_COUNTRIES=$(cat "$CONFIG_FILE" | jq -r '.blocked_countries[]' 2>/dev/null | tr '\n' ' ')
    
    if [[ " $BLOCKED_COUNTRIES " =~ " $COUNTRY_ISO " ]]; then
        echo -e "  ${RED}â›” WARNING: Your current location ($FLAG $COUNTRY_DISPLAY) is in the sanctioned list!${NC}"
        echo -e "  ${YELLOW}Git pushes will be blocked from this location.${NC}"
    else
        echo -e "  ${GREEN}âœ… Your location ($FLAG $COUNTRY_DISPLAY) is not restricted.${NC}"
        echo -e "  ${GREEN}Git pushes are allowed from this location.${NC}"
    fi
    
    # Check if bypasses are active
    if [ "${SKIP_IP_CHECK}" = "1" ]; then
        echo -e "  ${YELLOW}âš ï¸  Note: SKIP_IP_CHECK environment variable is set${NC}"
    fi
    
    if git rev-parse --git-dir > /dev/null 2>&1; then
        if [ "$(git config --get hooks.allowpush)" = "true" ]; then
            echo -e "  ${YELLOW}âš ï¸  Note: IP checks are disabled for this repository${NC}"
        fi
    fi
else
    echo -e "  ${YELLOW}Git IP Guard is not installed.${NC}"
fi

echo ""
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# Show current time
echo -e "${MAGENTA}Generated at: $(date '+%Y-%m-%d %H:%M:%S %Z')${NC}"
